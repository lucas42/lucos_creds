<html>
	<head>
		<title>LucOs Credentials - View Credential</title>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" />
		<link href="/style.css" rel="stylesheet" />
		<link rel="icon" href="/icon.png" />
	</head>
	<body>
		<lucos-navbar bg-colour="#334">Creds</lucos-navbar>
		<nav id="breadcrumbs">
			<a href="/">Credentials</a> &gt;
			<a href="/system/<%=encodeURI(system)%>"><%= system.replaceAll("_"," ") %></a> &gt;
			<a href="/system/<%=encodeURI(system)%>/<%=encodeURI(environment)%>"><%= environment %></a> &gt;
			<span><%= key %></span>
		</nav>
		<main class="view-credential">
			<h1>
				<span class="system-name"><%= system.replaceAll("_", " ") %></span>
				<span class="environment-name environment-<%= environment %>"><%= environment %></span>
			</h1>
			<div class="view-field">
				<span class="view-label">Key: </span>
				<span class="key"><%= key %></span>
			</div>
			<div class="view-field">
				<span class="view-label">Value: </span>
				<span class="value"><%= value %></span>
			</div>
			<% if (type == "simple") { %>
				<form action="/update-simple-credential" method="get" class="inline-form">
					<input type="hidden" name="system" value="<%= system %>" />
					<input type="hidden" name="environment" value="<%= environment %>" />
					<input type="hidden" name="key" value="<%= key %>" />
					<input type="submit" title="Edit Credential" value="✎ Edit" class="inline-button edit-button" />
				</form>
				<form action="/delete-simple-credential" method="get" class="inline-form">
					<input type="hidden" name="system" value="<%= system %>" />
					<input type="hidden" name="environment" value="<%= environment %>" />
					<input type="hidden" name="key" value="<%= key %>" />
					<input type="submit" title="Delete Credential" value="⛌ Delete" class="inline-button delete-button" />
				</form>
			<% } else if (type == "built-in") { %>
				<p class="note">This value is hardcoded and can't be edited.</p>
			<% } else if (type == "client") { %>
				<form action="/update-linked-credential" method="get" class="inline-form">
					<input type="hidden" name="clientsystem" value="<%= system %>" />
					<input type="hidden" name="clientenvironment" value="<%= environment %>" />
					<input type="hidden" name="serversystem" value="<%= key.replace("KEY_", "").toLowerCase() %>" />
					<!-- TODO: figure out the current serverenviornment -->
					<input type="submit" title="Refresh Credential" value="♺ Refresh" class="inline-button refresh-button" />
				</form>
			<% } else if (type == "server") { %>
				<h3>Linked Clients</h3>
				<ul>
					<% const apikeys = value.split(";");
					for (var ii=0; ii<apikeys.length; ii++) {
						const [clientsystem, clientenvironment] = apikeys[ii].split('=')[0].split(':',2); %>
						<li>
							<a href="/system/<%=encodeURI(clientsystem)%>/<%=encodeURI(clientenvironment)%>">
								<span class="system-name"><%= clientsystem.replaceAll("_", " ")%></span>
								<span class="environment-name environment-<%= clientenvironment %>"><%= clientenvironment %></span>
							</a>
							<form action="/update-linked-credential" method="get" class="inline-form">
								<input type="hidden" name="clientsystem" value="<%= clientsystem %>" />
								<input type="hidden" name="clientenvironment" value="<%= clientenvironment %>" />
								<input type="hidden" name="serversystem" value="<%= system %>" />
								<input type="hidden" name="serverenvironment" value="<%= environment %>" />
								<input type="submit" title="Refresh Credential" value="♺" class="inline-button refresh-button" />
							</form>
						</li>
					<% } %>
				</ul>

				<form action="/update-linked-credential" method="get" class="inline-form">
					<input type="hidden" name="serversystem" value="<%= system %>" />
					<input type="hidden" name="serverenvironment" value="<%= environment %>" />
					<input type="submit" title="Add Linked Credential where this system is the server" value="＋ Add" class="inline-button add-button" />
				</form>
			<% } else  { %>
				<p class="note">This credential is of an recognised type "<%=type%>".</p>
			<% } %>
		</main>
		<script type="text/javascript" src="/client.js"></script>
	</body>
</html>